<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.opennote.standard.component.itsm.mapper.ItsmRptMonthMapper">

    <sql id="where">
        <if test='schEtc00 !=null and schEtc00 !=""'>
            AND SVC_SN = #{schEtc00}
        </if>
        <if test='searchStartDate !=null and searchStartDate !=""'>
            <![CDATA[
				AND STR_TO_DATE(THIS_MONTH_START_YMD,'%Y%m') >= STR_TO_DATE(#{searchStartDate},'%Y.%m')
		 	]]>
        </if>
        <if test='searchEndDate !=null and searchEndDate !=""'>
            <![CDATA[
		 		AND STR_TO_DATE(THIS_MONTH_END_YMD,'%Y%m') <= STR_TO_DATE(#{searchEndDate},'%Y.%m')
	 		]]>
        </if>
    </sql>

    <!-- 월간보고 목록 조회 -->
    <select id="selectList" parameterType="itsmRptMthVO" resultType="itsmRptMthVO">
        /* ItsmRptMonthMapper.selectList */
        SELECT RPT_MONTH_SN														AS rptMonthSn
        , PRJ_NM															AS prjNm
        , SVC_SN															AS svcSn
        , ITSM_FNC_SVC_NM(SVC_SN)													AS svcNm
        , CNTR_START_YMD													AS cntrStartYmd
        , CNTR_END_YMD 													AS cntrEndYmd
        , CNTR_NO															AS cntrNo
        , CMPN_NM															AS cmpnNm
        , ANLY_START_YMD													AS anlyStartYmd
        , ANLY_END_YMD 													AS anlyEndYmd
        , DSGN_START_YMD													AS dsgnStartYmd
        , DSGN_END_YMD 													AS dsgnEndYmd
        , IMP_START_YMD													AS impStartYmd
        , IMP_END_YMD 														AS impEndYmd
        , TEST_START_YMD													AS testStartYmd
        , TEST_END_YMD 													AS testEndYmd
        , PILOT_START_YMD													AS pilotStartYmd
        , PILOT_END_YMD													AS pilotEndYmd
        , ANLY_PRFR														AS anlyPrfr
        , DSGN_PRFR                                                        AS dsgnPrfr
        , IMP_PRFR                                                         AS impPrfr
        , TEST_PRFR                                                        AS testPrfr
        , PILOT_PRFR                                                       AS pilotPrfr
        , ANLY_PLAN                                                        AS anlyPlan
        , DSGN_PLAN                                                        AS dsgnPlan
        , IMP_PLAN                                                         AS impPlan
        , TEST_PLAN                                                        AS testPlan
        , PILOT_PLAN                                                       AS pilotPlan
        , MON_WEEK 														AS monWeek
        , EMP_PRJ1                                                     	AS empPrj1
        , EMP_PLAN1                                                    	AS empPlan1
        , EMP_DSGN1                                                    	AS empDsgn1
        , EMP_DEV1                                                     	AS empDev1
        , EMP_PRJ2                                                     	AS empPrj2
        , EMP_PLAN2                                                    	AS empPlan2
        , EMP_DSGN2                                                    	AS empDsgn2
        , EMP_DEV2                                                     	AS empDev2
        , EMP_PRJ3                                                     	AS empPrj3
        , EMP_PLAN3                                                    	AS empPlan3
        , EMP_DSGN3                                                    	AS empDsgn3
        , EMP_DEV3                                                     	AS empDev3
        , EMP_PRJ4                                                     	AS empPrj4
        , EMP_PLAN4                                                    	AS empPlan4
        , EMP_DSGN4                                                    	AS empDsgn4
        , EMP_DEV4                                                     	AS empDev4
        , EMP_PRJ5                                                     	AS empPrj5
        , EMP_PLAN5                                                    	AS empPlan5
        , EMP_DSGN5                                                    	AS empDsgn5
        , EMP_DEV5                                                     	AS empDev5
        , ISSUE_CN                                                         AS issueCn
        , ACTN_PLAN                                                        AS actnPlan
        , THIS_PRFR                                                        AS thisPrfr
        , NEXT_PLAN                                                        AS nextPlan
        , RPT_MONTH_RMRK                                                   AS rptMonthRmrk
        , TO_CHAR(STR_TO_DATE(THIS_MONTH_START_YMD,'%Y%m%d'),'YYYY.MM.DD') 	AS thisMonthStartYmd
        , TO_CHAR(STR_TO_DATE(THIS_MONTH_END_YMD,'%Y%m%d'),'YYYY.MM.DD')   	AS thisMonthEndYmd
        , ITSM_FNC_USER_INFO(RGST_SN, 'USER_NM')                                  AS rgstSn
        , TO_CHAR(RGST_DT,'YYYY.MM.DD')                                    AS rgstDt
        , TO_CHAR(RVSE_DT,'YYYY.MM.DD')                                    AS rvseDt
        FROM itsm_rpt_month
        WHERE USE_YN = 'Y'
        <include refid="where"/>
        ORDER BY MON_WEEK DESC
        LIMIT #{firstRecordIndex}, #{recordCountPerPage}
    </select>

    <!-- 월간보고 목록 건수 -->
    <select id="selectCount" parameterType="itsmRptMthVO" resultType="int">
        /* ItsmRptMonthMapper.selectCount */
        SELECT COUNT(1)
        FROM itsm_rpt_month
        WHERE USE_YN ='Y'
        <include refid="where"/>
    </select>

    <!-- 월간보고 상세 조회 -->
    <select id="selectContents" parameterType="itsmRptMthVO" resultType="itsmRptMthVO">
        /* ItsmRptMonthMapper.selectContents */
        SELECT RPT_MONTH_SN														AS rptMonthSn
             , PRJ_NM															AS prjNm
             , SVC_SN															AS svcSn
             , ITSM_FNC_SVC_NM(SVC_SN)													AS svcNm
             , CNTR_START_YMD													AS cntrStartYmd
             , CNTR_END_YMD 													AS cntrEndYmd
             , CNTR_NO															AS cntrNo
             , CMPN_NM															AS cmpnNm
             , MON_WEEK															AS monWeek
             , ANLY_START_YMD													AS anlyStartYmd
             , ANLY_END_YMD 													AS anlyEndYmd
             , DSGN_START_YMD													AS dsgnStartYmd
             , DSGN_END_YMD 													AS dsgnEndYmd
             , IMP_START_YMD													AS impStartYmd
             , IMP_END_YMD 														AS impEndYmd
             , TEST_START_YMD													AS testStartYmd
             , TEST_END_YMD 													AS testEndYmd
             , PILOT_START_YMD													AS pilotStartYmd
             , PILOT_END_YMD													AS pilotEndYmd
             , ANLY_PRFR														AS anlyPrfr
             , DSGN_PRFR                                                        AS dsgnPrfr
             , IMP_PRFR                                                         AS impPrfr
             , TEST_PRFR                                                        AS testPrfr
             , PILOT_PRFR                                                       AS pilotPrfr
             , ANLY_PLAN                                                        AS anlyPlan
             , DSGN_PLAN                                                        AS dsgnPlan
             , IMP_PLAN                                                         AS impPlan
             , TEST_PLAN                                                        AS testPlan
             , PILOT_PLAN                                                       AS pilotPlan
             , MON_WEEK 														AS monWeek
             , EMP_PRJ1                                                     	AS empPrj1
             , EMP_PLAN1                                                    	AS empPlan1
             , EMP_DSGN1                                                    	AS empDsgn1
             , EMP_DEV1                                                     	AS empDev1
             , EMP_PRJ2                                                     	AS empPrj2
             , EMP_PLAN2                                                    	AS empPlan2
             , EMP_DSGN2                                                    	AS empDsgn2
             , EMP_DEV2                                                     	AS empDev2
             , EMP_PRJ3                                                     	AS empPrj3
             , EMP_PLAN3                                                    	AS empPlan3
             , EMP_DSGN3                                                    	AS empDsgn3
             , EMP_DEV3                                                     	AS empDev3
             , EMP_PRJ4                                                     	AS empPrj4
             , EMP_PLAN4                                                    	AS empPlan4
             , EMP_DSGN4                                                    	AS empDsgn4
             , EMP_DEV4                                                     	AS empDev4
             , EMP_PRJ5                                                     	AS empPrj5
             , EMP_PLAN5                                                    	AS empPlan5
             , EMP_DSGN5                                                    	AS empDsgn5
             , EMP_DEV5                                                     	AS empDev5
             , ISSUE_CN                                                         AS issueCn
             , ACTN_PLAN                                                        AS actnPlan
             , THIS_PRFR                                                        AS thisPrfr
             , NEXT_PLAN                                                        AS nextPlan
             , DATE_FORMAT(STR_TO_DATE(THIS_MONTH_START_YMD,'%Y%m%d') ,'%Y.%m.%d') 	AS thisMonthStartYmd
             , DATE_FORMAT(STR_TO_DATE(THIS_MONTH_END_YMD,'%Y%m%d') ,'%Y.%m.%d') 	AS thisMonthEndYmd
             , DATE_FORMAT(STR_TO_DATE(NEXT_MONTH_START_YMD,'%Y%m%d') ,'%Y.%m.%d') 	AS nextMonthStartYmd
             , DATE_FORMAT(STR_TO_DATE(NEXT_MONTH_END_YMD,'%Y%m%d') ,'%Y.%m.%d') 	AS nextMonthEndYmd
             , RPT_MONTH_RMRK                                                   AS rptMonthRmrk
             , ITSM_FNC_USER_INFO(RGST_SN, 'USER_NM')                                  AS rgstSn
             , TO_CHAR(RGST_DT,'YYYY.MM.DD')                                    AS rgstDt
             , TO_CHAR(RVSE_DT,'YYYY.MM.DD')                                    AS rvseDt
             , MONWEEK1															AS monWeek1
             , MONWEEK2															AS monWeek2
             , MONWEEK3															AS monWeek3
             , MONWEEK4															AS monWeek4
             , MONWEEK5															AS monWeek5
             , WEEK_CNT															AS weekCnt
        FROM itsm_rpt_month
        WHERE USE_YN = 'Y'
          AND RPT_MONTH_SN = #{rptMonthSn}
    </select>

    <!-- 주요 논의 및 협조사항 목록 -->
    <select id="selectDscsList" parameterType="itsmRptMthVO" resultType="itsmRptMthVO">
        /* ItsmRptMonthMapper.selectDscsList */
        SELECT RPT_DSCS_SN			AS rptDscsSn
             , RPT_MONTH_SN			AS rptMonthSn
             , DSCS_GBN				AS dscsGbn
             , DSCS_ITEM			AS dscsItem
             , DSCS_CN				AS dscsCn
             , DSCS_RMRK			AS dscsRmrk
        FROM itsm_rpt_month_dscs
        WHERE USE_YN = 'Y'
          AND RPT_MONTH_SN = #{rptMonthSn}
    </select>

    <!-- 월간보고 등록 -->
    <insert id="insertContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.insertContents */
        INSERT INTO itsm_rpt_month(
                                    PRJ_NM
                                  , CNTR_START_YMD
                                  , CNTR_END_YMD
                                  , CNTR_NO
                                  , CMPN_NM
                                  , MON_WEEK
                                  , ANLY_START_YMD
                                  , ANLY_END_YMD
                                  , DSGN_START_YMD
                                  , DSGN_END_YMD
                                  , IMP_START_YMD
                                  , IMP_END_YMD
                                  , TEST_START_YMD
                                  , TEST_END_YMD
                                  , PILOT_START_YMD
                                  , PILOT_END_YMD
                                  , ANLY_PRFR
                                  , DSGN_PRFR
                                  , IMP_PRFR
                                  , TEST_PRFR
                                  , PILOT_PRFR
                                  , ANLY_PLAN
                                  , DSGN_PLAN
                                  , IMP_PLAN
                                  , TEST_PLAN
                                  , PILOT_PLAN
                                  , EMP_PRJ1
                                  , EMP_PLAN1
                                  , EMP_DSGN1
                                  , EMP_DEV1
                                  , EMP_PRJ2
                                  , EMP_PLAN2
                                  , EMP_DSGN2
                                  , EMP_DEV2
                                  , EMP_PRJ3
                                  , EMP_PLAN3
                                  , EMP_DSGN3
                                  , EMP_DEV3
                                  , EMP_PRJ4
                                  , EMP_PLAN4
                                  , EMP_DSGN4
                                  , EMP_DEV4
                                  , EMP_PRJ5
                                  , EMP_PLAN5
                                  , EMP_DSGN5
                                  , EMP_DEV5
                                  , ISSUE_CN
                                  , ACTN_PLAN
                                  , THIS_PRFR
                                  , NEXT_PLAN
                                  , THIS_MONTH_START_YMD
                                  , THIS_MONTH_END_YMD
                                  , NEXT_MONTH_START_YMD
                                  , NEXT_MONTH_END_YMD
                                  , RPT_MONTH_RMRK
                                  , RGST_SN
                                  , RGST_DT
        ) VALUES (
                     'MCS 취약계층 복지서비스'
                 , '2023.07.11'
                 , '2023.12.15'
                 , '202307047AC - 00'
                 , '주식회사 오픈노트'
                 , #{monWeek, jdbcType=VARCHAR}
                 , '23.08'
                 , '23.08'
                 , '23.08'
                 , '23.09'
                 , '23.09'
                 , '23.11'
                 , '23.11'
                 , '23.11'
                 , '23.11'
                 , '23.12'
                 , #{anlyPrfr, jdbcType=VARCHAR}
                 , #{dsgnPrfr, jdbcType=VARCHAR}
                 , #{impPrfr, jdbcType=VARCHAR}
                 , #{testPrfr, jdbcType=VARCHAR}
                 , #{pilotPrfr, jdbcType=VARCHAR}
                 , #{anlyPlan, jdbcType=VARCHAR}
                 , #{dsgnPlan, jdbcType=VARCHAR}
                 , #{impPlan, jdbcType=VARCHAR}
                 , #{testPlan, jdbcType=VARCHAR}
                 , #{pilotPlan, jdbcType=VARCHAR}
                 , #{empPrj1, jdbcType=VARCHAR}
                 , #{empPlan1, jdbcType=VARCHAR}
                 , #{empDsgn1, jdbcType=VARCHAR}
                 , #{empDev1, jdbcType=VARCHAR}
                 , #{empPrj2, jdbcType=VARCHAR}
                 , #{empPlan2, jdbcType=VARCHAR}
                 , #{empDsgn2, jdbcType=VARCHAR}
                 , #{empDev2, jdbcType=VARCHAR}
                 , #{empPrj3, jdbcType=VARCHAR}
                 , #{empPlan3, jdbcType=VARCHAR}
                 , #{empDsgn3, jdbcType=VARCHAR}
                 , #{empDev3, jdbcType=VARCHAR}
                 , #{empPrj4, jdbcType=VARCHAR}
                 , #{empPlan4, jdbcType=VARCHAR}
                 , #{empDsgn4, jdbcType=VARCHAR}
                 , #{empDev4, jdbcType=VARCHAR}
                 , #{empPrj5, jdbcType=VARCHAR}
                 , #{empPlan5, jdbcType=VARCHAR}
                 , #{empDsgn5, jdbcType=VARCHAR}
                 , #{empDev5, jdbcType=VARCHAR}
                 , #{issueCn, jdbcType=VARCHAR}
                 , #{actnPlan, jdbcType=VARCHAR}
                 , #{thisPrfr, jdbcType=VARCHAR}
                 , #{nextPlan, jdbcType=VARCHAR}
                 , #{thisMonthStartYmd, jdbcType=VARCHAR}
                 , #{thisMonthEndYmd, jdbcType=VARCHAR}
                 , #{nextMonthStartYmd, jdbcType=VARCHAR}
                 , #{nextMonthEndYmd, jdbcType=VARCHAR}
                 , #{rptMonthRmrk, jdbcType=VARCHAR}
                 , #{loginSerno, jdbcType=VARCHAR}
                 , NOW()
                 )

    </insert>

    <!-- 월간보고 수정 -->
    <update id="updateContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.updateContents */
		<![CDATA[
        UPDATE itsm_rpt_month
        SET ANLY_PRFR				= #{anlyPrfr, jdbcType=VARCHAR}
          , DSGN_PRFR                = #{dsgnPrfr, jdbcType=VARCHAR}
          , IMP_PRFR                 = #{impPrfr, jdbcType=VARCHAR}
          , TEST_PRFR                = #{testPrfr, jdbcType=VARCHAR}
          , PILOT_PRFR               = #{pilotPrfr, jdbcType=VARCHAR}
          , ANLY_PLAN                = #{anlyPlan, jdbcType=VARCHAR}
          , DSGN_PLAN                = #{dsgnPlan, jdbcType=VARCHAR}
          , IMP_PLAN                 = #{impPlan, jdbcType=VARCHAR}
          , TEST_PLAN                = #{testPlan, jdbcType=VARCHAR}
          , PILOT_PLAN               = #{pilotPlan, jdbcType=VARCHAR}
          , EMP_PRJ1                 = #{empPrj1, jdbcType=VARCHAR}
          , EMP_PLAN1                = #{empPlan1, jdbcType=VARCHAR}
          , EMP_DSGN1                = #{empDsgn1, jdbcType=VARCHAR}
          , EMP_DEV1                 = #{empDev1, jdbcType=VARCHAR}
          , EMP_PRJ2                 = #{empPrj2, jdbcType=VARCHAR}
          , EMP_PLAN2                = #{empPlan2, jdbcType=VARCHAR}
          , EMP_DSGN2                = #{empDsgn2, jdbcType=VARCHAR}
          , EMP_DEV2                 = #{empDev2, jdbcType=VARCHAR}
          , EMP_PRJ3                 = #{empPrj3, jdbcType=VARCHAR}
          , EMP_PLAN3                = #{empPlan3, jdbcType=VARCHAR}
          , EMP_DSGN3                = #{empDsgn3, jdbcType=VARCHAR}
          , EMP_DEV3                 = #{empDev3, jdbcType=VARCHAR}
          , EMP_PRJ4                 = #{empPrj4, jdbcType=VARCHAR}
          , EMP_PLAN4                = #{empPlan4, jdbcType=VARCHAR}
          , EMP_DSGN4                = #{empDsgn4, jdbcType=VARCHAR}
          , EMP_DEV4                 = #{empDev4, jdbcType=VARCHAR}
          , EMP_PRJ5                 = #{empPrj5, jdbcType=VARCHAR}
          , EMP_PLAN5                = #{empPlan5, jdbcType=VARCHAR}
          , EMP_DSGN5                = #{empDsgn5, jdbcType=VARCHAR}
          , EMP_DEV5                 = #{empDev5, jdbcType=VARCHAR}
          , ISSUE_CN                 = #{issueCn, jdbcType=VARCHAR}
          , ACTN_PLAN                = #{actnPlan, jdbcType=VARCHAR}
          , THIS_PRFR                = #{thisPrfr, jdbcType=VARCHAR}
          , NEXT_PLAN                = #{nextPlan, jdbcType=VARCHAR}
          , RPT_MONTH_RMRK           = #{rptMonthRmrk, jdbcType=VARCHAR}
          , RVSE_SN                  = #{loginSerno, jdbcType=VARCHAR}
          , RVSE_DT                  = NOW()
        WHERE RPT_MONTH_SN = #{rptMonthSn}
        ]]>
    </update>

    <!-- 월간보고 삭제 -->
    <update id="deleteContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.deleteContents */
        UPDATE itsm_rpt_month
        SET USE_YN = 'N'
        WHERE RPT_MONTH_SN = #{rptMonthSn}
    </update>


    <!-- 주요 논의 및 협조사항 useYn N처리 -->
    <update id="updateDscsUseYnN" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.updateDscsUseYnN */
        UPDATE itsm_rpt_month_dscs
        SET USE_YN = 'N'
        WHERE RPT_MONTH_SN = #{rptMonthSn}
    </update>

    <!-- 주요 논의 및 협조사항 목록 등록  -->
    <insert id="insertDscsContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.insertDscsContents */
        INSERT INTO itsm_rpt_month_dscs(
                                         RPT_MONTH_SN
                                       , DSCS_GBN
                                       , DSCS_ITEM
                                       , DSCS_CN
                                       , DSCS_RMRK
                                       , RGST_SN
                                       , RGST_DT  )
        VALUES (
                   #{rptMonthSn, jdbcType=VARCHAR}
               , #{dscsGbn, jdbcType=VARCHAR}
               , #{dscsItem, jdbcType=VARCHAR}
               , #{dscsCn, jdbcType=VARCHAR}
               , #{dscsRmrk, jdbcType=VARCHAR}
               , #{loginSerno, jdbcType=VARCHAR}
               , NOW()
               )
    </insert>

    <!-- 주요 논의 및 협조사항 목록 수정  -->
    <update id="updateDscsContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.updateDscsContents */
        UPDATE itsm_rpt_month_dscs
        SET RPT_MONTH_SN = #{rptMonthSn, jdbcType=VARCHAR}
          , DSCS_GBN = #{dscsGbn, jdbcType=VARCHAR}
          , DSCS_ITEM = #{dscsItem, jdbcType=VARCHAR}
          , DSCS_CN = #{dscsCn, jdbcType=VARCHAR}
          , DSCS_RMRK = #{dscsRmrk, jdbcType=VARCHAR}
          , USE_YN = 'Y'
          , RVSE_SN = #{loginSerno}
          , RVSE_DT = NOW()
        WHERE RPT_DSCS_SN = #{rptDscsSn}
    </update>


    <!-- 배치) 해당월 주차 수 조회 -->
    <select id="selectWeekCount" parameterType="itsmRptWeekVO" resultType="int" >
        /* RptMapper.selectWeekCount */
        SELECT
                FLOOR((DAY(LAST_DAY(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'))) - 1 + WEEKDAY(DATE_FORMAT(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'), '%Y-%m-01'))) / 7) + 1 AS weekCnt;
    </select>

    <!-- 배치) 해당월 시작종료날짜, 차월 시작종료날짜 -->
    <select id="selectFirstLastYmd"  parameterType="itsmRptMthVO" resultType="itsmRptMthVO" >
        /* ItsmRptMonthMapper.selectFirstLastYmd */
        SELECT CONCAT(YEAR(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'년 ',MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월') AS monWeek
             , DATE_FORMAT(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'), '%Y%m01') AS thisMonthStartYmd
             , DATE_FORMAT(LAST_DAY(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')), '%Y%m%d') AS thisMonthEndYmd
             , DATE_FORMAT(DATE_ADD(LAST_DAY(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')), INTERVAL 1 DAY), '%Y%m%d')  AS nextMonthStartYmd
             , DATE_FORMAT(LAST_DAY(DATE_ADD(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'), INTERVAL 1 MONTH)), '%Y%m%d') AS nextMonthEndYmd
    </select>

    <!-- 배치) itsm_rpt_month 중복체크 -->
    <select id="selectRptDupleChk" parameterType="itsmRptMthVO" resultType="int" >
        /* ItsmRptMonthMapper.selectRptDupleChk */
        SELECT COUNT(1)
        FROM itsm_rpt_month A
        WHERE A.USE_YN ='Y'
          AND A.THIS_MONTH_START_YMD = #{thisMonthStartYmd}
          AND A.THIS_MONTH_END_YMD = #{thisMonthEndYmd}
          AND A.SVC_SN = #{svcSn}
    </select>

    <!-- 배치) 주요 논의 및 협조사항 등록 -->
    <insert id="insertBatchDscs" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.insertBatchDscs */
        INSERT INTO itsm_rpt_month_dscs (
                  RPT_MONTH_SN
                , DSCS_GBN
                , DSCS_ITEM
                , DSCS_CN
                , DSCS_RMRK
        )
        SELECT
            #{rptMonthSn}
             , DSCS_GBN
             , DSCS_ITEM
             , DSCS_CN
             , DSCS_RMRK
        FROM itsm_rpt_month_dscs A
        WHERE RPT_MONTH_SN IN (SELECT MAX(RPT_MONTH_SN) FROM itsm_rpt_month)
          AND USE_YN = 'Y'
        ORDER BY RPT_DSCS_SN
    </insert>

    <!-- 배치) itsm_rpt_month 등록 -->
    <insert id="insertBatchContents" parameterType="itsmRptMthVO">
        /* ItsmRptMonthMapper.insertBatchContents */
        <selectKey keyProperty="rptMonthSn" order="AFTER" resultType="String" >
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO itsm_rpt_month (
        PRJ_NM
        , SVC_SN
        , CNTR_START_YMD
        , CNTR_END_YMD
        , CNTR_NO
        , CMPN_NM
        , ANLY_START_YMD
        , ANLY_END_YMD
        , DSGN_START_YMD
        , DSGN_END_YMD
        , IMP_START_YMD
        , IMP_END_YMD
        , TEST_START_YMD
        , TEST_END_YMD
        , PILOT_START_YMD
        , PILOT_END_YMD
        , ANLY_PRFR
        , DSGN_PRFR
        , IMP_PRFR
        , TEST_PRFR
        , PILOT_PRFR
        , ANLY_PLAN
        , DSGN_PLAN
        , IMP_PLAN
        , TEST_PLAN
        , PILOT_PLAN
        , EMP_PRJ1
        , EMP_PLAN1
        , EMP_DSGN1
        , EMP_DEV1
        , EMP_PRJ2
        , EMP_PLAN2
        , EMP_DSGN2
        , EMP_DEV2
        , EMP_PRJ3
        , EMP_PLAN3
        , EMP_DSGN3
        , EMP_DEV3
        , EMP_PRJ4
        , EMP_PLAN4
        , EMP_DSGN4
        , EMP_DEV4
        , EMP_PRJ5
        , EMP_PLAN5
        , EMP_DSGN5
        , EMP_DEV5
        , ISSUE_CN
        , ACTN_PLAN
        , THIS_PRFR
        , NEXT_PLAN
        , THIS_MONTH_START_YMD
        , THIS_MONTH_END_YMD
        , NEXT_MONTH_START_YMD
        , NEXT_MONTH_END_YMD
        , RPT_MONTH_RMRK
        , WEEK_CNT
        , MON_WEEK
        , MONWEEK1
        , MONWEEK2
        , MONWEEK3
        , MONWEEK4
        <if test='weekCnt!=null and  weekCnt!="" and weekCnt == "5"'>
            , MONWEEK5
        </if>
        )
        SELECT
        ITSM_FNC_SVC_NM(#{svcSn}) PRJ_NM
        , #{svcSn}
        , '2023.07.11' CNTR_START_YMD
        , '2023.12.15' CNTR_END_YMD
        , '202307047AC - 00' CNTR_NO
        , '주식회사 오픈노트' CMPN_NM
        , '23.08' ANLY_START_YMD
        , '23.08' ANLY_END_YMD
        , '23.08' DSGN_START_YMD
        , '23.09' DSGN_END_YMD
        , '23.09' IMP_START_YMD
        , '23.11' IMP_END_YMD
        , '23.11' TEST_START_YMD
        , '23.11' TEST_END_YMD
        , '23.11' PILOT_START_YMD
        , '23.12' PILOT_END_YMD
        , NVL(B.ANLY_PRFR,0) ANLY_PRFR
        , NVL(B.DSGN_PRFR,0) DSGN_PRFR
        , NVL(B.IMP_PRFR,0) IMP_PRFR
        , NVL(B.TEST_PRFR,0) TEST_PRFR
        , NVL(B.PILOT_PRFR,0) PILOT_PRFR
        , NVL(B.ANLY_PLAN,0) ANLY_PLAN
        , NVL(B.DSGN_PLAN,0) DSGN_PLAN
        , NVL(B.IMP_PLAN,0) IMP_PLAN
        , NVL(B.TEST_PLAN,0) TEST_PLAN
        , NVL(B.PILOT_PLAN,0) PILOT_PLAN
        , NVL(B.EMP_PRJ1,0) EMP_PRJ1
        , NVL(B.EMP_PLAN1,0) EMP_PLAN1
        , NVL(B.EMP_DSGN1,0) EMP_DSGN1
        , NVL(B.EMP_DEV1,0) EMP_DEV1
        , NVL(B.EMP_PRJ2,0) EMP_PRJ2
        , NVL(B.EMP_PLAN2,0) EMP_PLAN2
        , NVL(B.EMP_DSGN2,0) EMP_DSGN2
        , NVL(B.EMP_DEV2,0) EMP_DEV2
        , NVL(B.EMP_PRJ3,0) EMP_PRJ3
        , NVL(B.EMP_PLAN3,0) EMP_PLAN3
        , NVL(B.EMP_DSGN3,0) EMP_DSGN3
        , NVL(B.EMP_DEV3,0) EMP_DEV3
        , NVL(B.EMP_PRJ4,0) EMP_PRJ4
        , NVL(B.EMP_PLAN4,0) EMP_PLAN4
        , NVL(B.EMP_DSGN4,0) EMP_DSGN4
        , NVL(B.EMP_DEV4,0) EMP_DEV4
        , NVL(B.EMP_PRJ5,0) EMP_PRJ5
        , NVL(B.EMP_PLAN5,0) EMP_PLAN5
        , NVL(B.EMP_DSGN5,0) EMP_DSGN5
        , NVL(B.EMP_DEV5 ,0) EMP_DEV5
        , NVL(B.ISSUE_CN,'') ISSUE_CN
        , NVL(B.ACTN_PLAN,'') ACTN_PLAN
        , NVL(B.THIS_PRFR,'') THIS_PRFR
        , NVL(B.NEXT_PLAN,'') NEXT_PLAN
        , DATE_FORMAT(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'), '%Y%m01') THIS_MONTH_START_YMD
        , DATE_FORMAT(LAST_DAY(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')), '%Y%m%d') THIS_MONTH_END_YMD
        , DATE_FORMAT(DATE_ADD(LAST_DAY(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')), INTERVAL 1 DAY), '%Y%m%d') NEXT_MONTH_START_YMD
        , DATE_FORMAT(LAST_DAY(DATE_ADD(STR_TO_DATE(#{crtDate}, '%Y.%m.%d'), INTERVAL 1 MONTH)), '%Y%m%d') NEXT_MONTH_END_YMD
        , NVL(B.RPT_MONTH_RMRK,'') RPT_MONTH_RMRK
        , #{weekCnt}
        , CONCAT(YEAR(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'년 ',MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월') MON_WEEK
        , CONCAT(MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월', ' 1주') MONWEEK1
        , CONCAT(MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월', ' 2주') MONWEEK2
        , CONCAT(MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월', ' 3주') MONWEEK3
        , CONCAT(MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월', ' 4주') MONWEEK4
        <if test='weekCnt!=null and  weekCnt!="" and weekCnt == "5"'>
            , CONCAT(MONTH(STR_TO_DATE(#{crtDate}, '%Y.%m.%d')),'월', ' 5주') MONWEEK5
        </if>
        FROM (select 1 as dummy) PA
        left join (
        SELECT
        RPT_MONTH_SN
        , SVC_SN
        , PRJ_NM
        , CNTR_START_YMD
        , CNTR_END_YMD
        , CNTR_NO
        , CMPN_NM
        , ANLY_START_YMD
        , ANLY_END_YMD
        , DSGN_START_YMD
        , DSGN_END_YMD
        , IMP_START_YMD
        , IMP_END_YMD
        , TEST_START_YMD
        , TEST_END_YMD
        , PILOT_START_YMD
        , PILOT_END_YMD
        , ANLY_PRFR
        , DSGN_PRFR
        , IMP_PRFR
        , TEST_PRFR
        , PILOT_PRFR
        , ANLY_PLAN
        , DSGN_PLAN
        , IMP_PLAN
        , TEST_PLAN
        , PILOT_PLAN
        , EMP_PRJ1
        , EMP_PLAN1
        , EMP_DSGN1
        , EMP_DEV1
        , EMP_PRJ2
        , EMP_PLAN2
        , EMP_DSGN2
        , EMP_DEV2
        , EMP_PRJ3
        , EMP_PLAN3
        , EMP_DSGN3
        , EMP_DEV3
        , EMP_PRJ4
        , EMP_PLAN4
        , EMP_DSGN4
        , EMP_DEV4
        , EMP_PRJ5
        , EMP_PLAN5
        , EMP_DSGN5
        , EMP_DEV5
        , ISSUE_CN
        , ACTN_PLAN
        , THIS_PRFR
        , NEXT_PLAN
        , RPT_MONTH_RMRK
        FROM itsm_rpt_month
        WHERE USE_YN = 'Y'
        ORDER BY RPT_MONTH_SN DESC
        limit 1) B
        ON  #{svcSn} = B.SVC_SN
    </insert>


</mapper>