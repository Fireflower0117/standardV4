<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.opennote.standard.mapper.basic.UserMngMapper">

	<!-- 검색 조건 -->
	<sql id="Where">
		<if test='searchKeyword !=null and searchKeyword !=""'>
			<if test='searchCondition == null or searchCondition == ""'>
				AND (UPPER(A.USER_ID) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%')
				 OR UPPER(A.USER_NM) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%')
				 OR UPPER(A.USER_EMAIL_ADDR) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%'))
			</if>
			<if test='searchCondition != null and searchCondition != "" and searchCondition == 1'>
				AND UPPER(A.USER_ID) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%')
			</if>
			<if test='searchCondition != null and searchCondition != "" and searchCondition == 2'>
				AND UPPER(A.USER_NM) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%')
			</if>
			<if test='searchCondition != null and searchCondition != "" and searchCondition == 3'>
				AND UPPER(A.USER_EMAIL_ADDR) LIKE CONCAT('%',UPPER(#{searchKeyword}),'%')
			</if>
		</if>
	</sql>

	<!-- 사용자 목록 수 조회 -->
	<select id="selectUsertList" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectUsertList */
		SELECT A.USER_SERNO			userSerno
			 , A.USER_ID			userId
			 , A.USER_NM			userNm
			 , A.USER_TEL_NO		userTelNo
			 , A.USER_EMAIL_ADDR	userEmailAddr
			 , A.BRK_YN				brkYn
			 , A.USE_YN				useYn
			 , B.GRP_AUTH_NM		grpAuthNm
			 , CASE WHEN A.PSWD_MSMT_NOCS <![CDATA[ >= ]]> (SELECT LGIN_LMT_CNT FROM T_LGIN_PLCY_MNG) THEN 'Y'
			 		ELSE 'N'
			 	END 					lockYn
		  FROM T_USER_MNG A
	 LEFT JOIN T_GRP_AUTH_MNG B
		    ON A.GRP_AUTH_ID  = B.GRP_AUTH_ID
		   AND B.DEL_YN 	  = 'N'
		<where>
			<include refid="Where"/>
		   AND A.AUTH_AREA_CD = #{authAreaCd}
		</where>
	  ORDER BY USER_SERNO DESC
		 LIMIT #{firstRecordIndex} , #{recordCountPerPage}
	</select>

	<!-- 사용자 목록 조회 -->
	<select id="selectUserCount" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectUserCount */
		SELECT COUNT(1) userCount
		  FROM T_USER_MNG A
		<where>
			<include refid="Where"/>
		   AND A.AUTH_AREA_CD = #{authAreaCd}
		</where>
	</select>

	<!-- 사용자 상세 조회 -->
	<select id="selectContents" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectContents */
		SELECT USER_SERNO		userSerno
			 , USER_ID			userId
			 , USER_NM			userNm
			 , USER_TEL_NO		userTelNo
			 , USER_EMAIL_ADDR	userEmailAddr
			 , POST_NO			postNo
			 , HOME_ADDR		homeAddr
			 , HOME_ADDR_DTLS	homeAddrDtls
			 , BRK_YN			brkYn
			 , USE_YN			useYn
			 , GRP_AUTH_ID		grpAuthId
			 , AUTH_AREA_CD		authAreaCd
			 , SNS_SE_CD		snsSeCd
			 , CASE WHEN PSWD_MSMT_NOCS <![CDATA[ >= ]]> (SELECT LGIN_LMT_CNT FROM T_LGIN_PLCY_MNG) THEN 'Y'
			 		ELSE 'N' 
			   END 				lockYn
		  FROM T_USER_MNG
		 WHERE USER_SERNO 		= #{userSerno}
		   AND AUTH_AREA_CD 	= #{authAreaCd}
	</select>

	<insert id="insertContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.insertContents */
		INSERT INTO T_USER_MNG
			 ( USER_ID
			 , USER_NM
			 , USER_PSWD
			 , GRP_AUTH_ID
			 , USER_TEL_NO
			 , USER_EMAIL_ADDR
			 , UPDR_SERNO
			 , UPD_DT
			 , USE_YN
			 , BRK_YN
			 , AUTH_AREA_CD
			 , POST_NO
			 , HOME_ADDR
			 , HOME_ADDR_DTLS
			 )
		VALUES
		     ( #{userId}
		     , #{userNm}
			 , #{userPswd}
			 , #{grpAuthId}
			 , #{userTelNo}
			 , #{userEmailAddr}
			 , #{loginSerno}
			 , NOW()
			 , #{useYn}
			 , #{brkYn}
			 , #{authAreaCd}
			 , #{postNo}
			 , #{homeAddr}
			 , #{homeAddrDtls}
			 )
	</insert>
	
	<!-- 사용자 수정 -->
	<update id="updateContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.updateContents */
		UPDATE T_USER_MNG
		   SET USER_NM 				= #{userNm}
		   <if test='userPswd != null and userPswd != ""'>
		     , USER_PSWD			= #{userPswd}
		   </if>
		     , GRP_AUTH_ID 			= #{grpAuthId}
		     , USER_TEL_NO 			= #{userTelNo}
		     , USER_EMAIL_ADDR 		= #{userEmailAddr}
		     , UPDR_SERNO 			= #{loginSerno}
		     , UPD_DT 				= NOW()
		     , USE_YN 				= #{useYn}
		     , BRK_YN 				= #{brkYn}
		     , AUTH_AREA_CD 		= #{authAreaCd}
		     , POST_NO 				= #{postNo}
		     , HOME_ADDR 			= #{homeAddr}
		     , HOME_ADDR_DTLS		= #{homeAddrDtls}
		 WHERE USER_SERNO 			= #{userSerno}
	</update>
	
	<!-- 사용자 삭제 -->
	<update id="deleteContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper."deleteContents" */
		UPDATE T_USER_MNG
		   SET USE_YN 	  = 'N'
		 WHERE USER_SERNO = #{userSerno}
	</update>
	
	<!-- 로그인 -->
	<select id="getCont" parameterType="loginVO" resultType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.getCont */
		SELECT USER_SERNO 										userSerno
			 , USER_ID 											userId
			 , USER_NM 											userNm
			 , GRP_AUTH_ID 										grpAuthId
			 , USER_TEL_NO 										userTelNo
			 , USER_EMAIL_ADDR 									userEmailAddr
			 , POST_NO											postNo
			 , HOME_ADDR										homeAddr
			 , HOME_ADDR_DTLS									homeAddrDtls
			 , BRK_YN											brkYn
			 , CASE WHEN PSWD_MSMT_NOCS != NULL THEN PSWD_MSMT_NOCS
			        ELSE 0
			    END AS 							pswdMsmtNocs
			 , DATE_FORMAT(LST_ACS_DT,'%Y-%m-%d %H:%i:%s')		lstAcsDt
			 , LST_PSWD_CHG_DT									lstPswdChgDt
			 , TRUNCATE(DATEDIFF(NOW(), LST_PSWD_CHG_DT), 0) 	pswdChgDt
			 , SNS_SE_CD										snsSeCd
			 , SNS_USER_ID										snsUserId
		  FROM T_USER_MNG 
		 WHERE USER_ID	= #{userId}
		   AND AUTH_AREA_CD = #{authAreaCd}
		   AND USE_YN 		= 'Y'
	</select>
	
	<!-- sns 계정 중복체크 -->
	<select id="snsUserIdOverChk" parameterType="loginVO" resultType="boolean">
		/* com.opennote.standard.mapper.basic.UserMngMapper.snsUserIdOverChk */
		SELECT CASE WHEN COUNT(SNS_USER_ID) > 0 THEN 1
					ELSE 0
			   END
		  FROM T_USER_MNG 
		 WHERE SNS_USER_ID  	= #{snsUserId}
		   AND SNS_SE_CD		= #{snsSeCd}
	</select>
	
	<!-- sns 로그인 -->
	<select id="getSnsCont" parameterType="loginVO" resultType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.getSnsCont */
		SELECT USER_SERNO 										userSerno
			 , USER_ID 											userId
			 , USER_NM 											userNm
			 , GRP_AUTH_ID 										grpAuthId
			 , USER_TEL_NO 										userTelNo
			 , USER_EMAIL_ADDR 									userEmailAddr
			 , POST_NO											postNo
			 , HOME_ADDR										homeAddr
			 , HOME_ADDR_DTLS									homeAddrDtls
			 , BRK_YN											brkYn
			 , NVL(PSWD_MSMT_NOCS, 0) 							pswdMsmtNocs
			 , LST_PSWD_CHG_DT									lstPswdChgDt
			 , TRUNCATE(DATEDIFF(NOW(), LST_PSWD_CHG_DT), 0) 	pswdChgDt
			 , SNS_SE_CD										snsSeCd
			 , SNS_USER_ID										snsUserId
		  FROM T_USER_MNG 
		 WHERE SNS_USER_ID  	= #{snsUserId}
		   AND SNS_SE_CD		= #{snsSeCd}
		   AND USE_YN 			= 'Y'
	</select>
	
	<!-- 아이디 중복체크 -->
	<select id="userIdOverChk" parameterType="userVO" resultType="boolean">
		/* com.opennote.standard.mapper.basic.UserMngMapper.userIdOverChk */
		SELECT CASE WHEN COUNT(A.USER_ID) > 0 THEN 0
					ELSE 1
			   END
		  FROM (SELECT USER_ID
				  FROM T_USER_MNG
				 WHERE USER_ID = #{userId}
			 UNION ALL
				SELECT USER_ID	
				  FROM T_USER_SCSS_MNG
				 WHERE USER_ID = #{userId}
		  	   ) A
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="findIdContents" parameterType="loginVO" resultType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.findIdContents */
		SELECT USER_SERNO		userSerno
			 , USER_ID 			userId
			 , USER_NM 			userNm
			 , USER_TEL_NO 		userTelNo
			 , USER_EMAIL_ADDR 	userEmailAddr
		FROM T_USER_MNG
		WHERE USER_TEL_NO 		= #{userTelNo}
		  AND USER_EMAIL_ADDR 	= #{userEmailAddr}
		  AND USER_NM 			= #{userNm}
		  AND AUTH_AREA_CD 		= 'FT'
		  AND USE_YN 			= 'Y'
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="findPswdContents" parameterType="loginVO" resultType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.findPswdContents */
		SELECT USER_SERNO		userSerno
			 , USER_ID 			userId
			 , USER_NM 			userNm
			 , USER_TEL_NO 		userTelNo
			 , USER_EMAIL_ADDR 	userEmailAddr
		  FROM T_USER_MNG
		 WHERE USER_ID 			= #{userId}
		   AND USER_TEL_NO 		= #{userTelNo}
		   AND USER_EMAIL_ADDR 	= #{userEmailAddr}
		   AND USER_NM 			= #{userNm}
		   AND AUTH_AREA_CD 	= 'FT'
		   AND USE_YN 			= 'Y'
	</select>
	
	<!-- 사용자 계정 생성 -->
	<update id="joinContents" parameterType="userVO" useGeneratedKeys="true" keyProperty="userSerno">
		/* com.opennote.standard.mapper.basic.UserMngMapper.joinContents */
		INSERT INTO T_USER_MNG
		     ( USER_ID
			 , USER_PSWD
			 , USER_NM
			 , GRP_AUTH_ID
			 , USER_TEL_NO
			 , USER_EMAIL_ADDR
			 , AUTH_AREA_CD
			 , POST_NO
			 , HOME_ADDR
			 , HOME_ADDR_DTLS
			 , REG_DT
		<if test='snsUserId != null and snsUserId != ""'>
			 , SNS_SE_CD
			 , SNS_USER_ID
			 , INTG_YN
		</if>
	    	 )
	    VALUES
	         ( #{userId}
			 , #{userPswd}
			 , #{userNm}
			 , #{grpAuthId}
			 , #{userTelNo}
			 , #{userEmailAddr}
			 , 'FT'
			 , #{postNo}
			 , #{homeAddr}
			 , #{homeAddrDtls}
			 , NOW()
		<if test='snsUserId != null and snsUserId != ""'>
			 , #{snsSeCd}
			 , #{snsUserId}
			 , 'Y'
		</if>
			 )
	</update>
	
	<!-- 비밀번호 불일치 건수 증가 -->
	<update id="pswdMsmtNocsUpdateContent" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.pswdMsmtNocsUpdateContent */
		UPDATE T_USER_MNG
		   SET PSWD_MSMT_NOCS = PSWD_MSMT_NOCS + 1
		 WHERE USER_ID 		  = #{userId}
	</update>
	
	<!-- 최종 접속 일시 갱신 -->
	<update id="userLstAcsDtUpdateContent" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.userLstAcsDtUpdateContent */
		UPDATE T_USER_MNG
		   SET LST_ACS_DT = NOW()
		 WHERE USER_ID 	  = #{userId}
	</update>
	
	<!-- 비밀번호 불일치 건수 초기화 -->
	<update id="userPswdMsmtNocsClearContent" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.userPswdMsmtNocsClearContent */
		UPDATE T_USER_MNG
		   SET PSWD_MSMT_NOCS = 0
		 WHERE USER_ID 	  	  = #{userId}
	</update>
	
	<!-- 잠금 해제 -->
	<update id="userUnLock" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.userUnLock */
		UPDATE T_USER_MNG
		   SET PSWD_MSMT_NOCS = 0
		 WHERE USER_SERNO IN (<foreach collection="schEtc11" item="item" separator=",">#{item}</foreach>)
	</update>
	
	<!-- 비밀번호 변경 -->
	<update id="updateUserPswd" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.updateUserPswd */
		UPDATE T_USER_MNG
		   SET USER_PSWD = #{userPswd}
		 WHERE USER_ID 	 = #{userId}
	</update>
	
	<!-- 최종 비밀번호 변경 일시 갱신 -->
	<update id="updateLastPswdChgDt" parameterType="loginVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.updateLastPswdChgDt */
		UPDATE T_USER_MNG
		   SET LST_PSWD_CHG_DT = NOW()
		 WHERE USER_ID 		   = #{userId}
	</update>
	
	<!-- 회원정보 수정 -->
	<update id="updateUserContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.updateUserContents */
		UPDATE T_USER_MNG
		   SET USER_NM 				= #{userNm}
		   <if test='userPswd != null and userPswd != ""'>
		     , USER_PSWD			= #{userPswd}
		   </if>
		     , USER_TEL_NO 			= #{userTelNo}
		     , USER_EMAIL_ADDR 		= #{userEmailAddr}
		     , UPDR_SERNO 			= #{ftLoginSerno}
		     , UPD_DT 				= NOW()
		     , POST_NO 				= #{postNo}
		     , HOME_ADDR 			= #{homeAddr}
		     , HOME_ADDR_DTLS		= #{homeAddrDtls}
		 WHERE USER_SERNO 			= #{userSerno}
	</update>

	<!-- 사용자 데이터 삭제 -->
	<delete id="deleteUserContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.deleteUserContents */
		DELETE FROM T_USER_MNG
		 WHERE USER_SERNO = #{userSerno}
	</delete>

	<!-- ID 중복체크 -->
	<select id="idOvlpSelectCount" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.idOvlpSelectCount */
		SELECT COUNT(1) userCount
		  FROM (SELECT USER_ID
				  FROM T_USER_MNG
				 WHERE USER_ID = #{userId}
				 UNION ALL
				SELECT USER_ID
				  FROM T_USER_SCSS_MNG
				 WHERE USER_ID = #{userId}
			   ) TOTAL
	</select>

	<!-- 탈퇴 유저 테이블로 이동 -->
	<insert id="moveUserContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.moveUserContents */
		INSERT INTO T_USER_SCSS_MNG ( 
			   USER_SERNO  
			 , USER_ID
			 , USER_PSWD
			 , USER_NM
			 , GRP_AUTH_ID
			 , USER_TEL_NO
			 , USER_EMAIL_ADDR
			 , PSWD_MSMT_NOCS
			 , BRK_YN
			 , LST_ACS_DT
			 , LST_PSWD_CHG_DT
			 , AUTH_AREA_CD
			 , SNS_SE_CD
			 , SNS_USER_ID
			 , INTG_YN
			 , POST_NO
			 , HOME_ADDR
			 , HOME_ADDR_DTLS
			 , BLON_NM
			 , FAX_NO
			 , INLN_NO
			 , JRNK_CD
			 , REGR_SERNO
			 , REG_DT
			 , UPDR_SERNO
			 , UPD_DT
			 , USE_YN
		) 
		SELECT USER_SERNO
			 , USER_ID
			 , USER_PSWD
			 , USER_NM
			 , GRP_AUTH_ID
			 , USER_TEL_NO
			 , USER_EMAIL_ADDR
			 , PSWD_MSMT_NOCS
			 , BRK_YN
			 , LST_ACS_DT
			 , LST_PSWD_CHG_DT
			 , AUTH_AREA_CD
			 , SNS_SE_CD
			 , SNS_USER_ID
			 , INTG_YN
			 , POST_NO
			 , HOME_ADDR
			 , HOME_ADDR_DTLS
			 , BLON_NM
			 , FAX_NO
			 , INLN_NO
			 , JRNK_CD
			 , REGR_SERNO
			 , REG_DT
			 , UPDR_SERNO
			 , UPD_DT
			 , USE_YN
		 FROM T_USER_MNG
		WHERE USER_SERNO = #{userSerno}
	</insert>
	
	<!-- sns 계정 연동 -->
	<update id="updateSnsConnContents" parameterType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.updateSnsConnContents */
		UPDATE T_USER_MNG
		   SET SNS_SE_CD 	= #{snsSeCd}
		   	 , SNS_USER_ID 	= #{snsUserId}
		     , INTG_YN 		= #{intgYn}
		 WHERE USER_SERNO 	= #{ftLoginSerno}
	</update>
	
	<!-- 사용자 엑셀 목록 조회 -->
	<select id="selectExcelList" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectExcelList */
		SELECT A.USER_ID									userId
			 , A.USER_NM									userNm
			 , B.GRP_AUTH_NM								grpAuthNm
			 , A.USER_TEL_NO								userTelNo
			 , A.USER_EMAIL_ADDR							userEmailAddr
			 , A.POST_NO									postNo
			 , A.HOME_ADDR									homeAddr
			 , A.HOME_ADDR_DTLS								homeAddrDtls
			 , A.PSWD_MSMT_NOCS
			 , CASE WHEN A.PSWD_MSMT_NOCS <![CDATA[ >= ]]> (SELECT LGIN_LMT_CNT FROM T_LGIN_PLCY_MNG) THEN 'Y'
			 		ELSE 'N'
			 	END 										lockYn
			 , DATE_FORMAT(A.LST_ACS_DT, '%Y.%m.%d')		lstAcsDt
			 , DATE_FORMAT(A.LST_PSWD_CHG_DT, '%Y.%m.%d')	lstPswdChgDt
			 , A.AUTH_AREA_CD								authAreaCd
			 , A.SNS_SE_CD									snsSeCd
			 , A.SNS_USER_ID								snsUserId
			 , A.BLON_NM									blonNm
			 , A.FAX_NO										faxNo
			 , A.INLN_NO									inlnNo
			 , A.BRK_YN										brkYn
			 , A.USE_YN										useYn
		  FROM T_USER_MNG A
	 LEFT JOIN T_GRP_AUTH_MNG B
		    ON A.GRP_AUTH_ID  = B.GRP_AUTH_ID
		   AND B.DEL_YN 	  = 'N'
		<where>
			<include refid="Where"/>
		   AND A.AUTH_AREA_CD = #{authAreaCd}
		</where>
	  ORDER BY USER_SERNO DESC
	</select>
	
	<!-- 사용자 비밀번호 조회 -->
	<select id="getUserPswd" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.getUserPswd */
		SELECT USER_ID
			 , USER_PSWD
		  FROM T_USER_MNG 
		 WHERE USER_ID 	= #{userId}
		   AND USE_YN		= 'Y'
	</select>

	<!-- 월별 가입추이(현재년도) -->
	<select id="selectScrbUserMon" resultType="CommonMap">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectScrbUserMon */
		SELECT DATE_FORMAT(REG_DT, '%m')        regDt
			 , COUNT(1)                         cnt
		FROM T_USER_MNG
		WHERE REG_DT <![CDATA[>=]]> DATE_FORMAT(NOW(), '%Y-01-01 00:00:00')
		GROUP BY DATE_FORMAT(REG_DT, '%m')
	</select>

	<!-- 일별 가입추이 -->
	<select id="selectScrbUserDay" parameterType="acsStatVO" resultType="CommonMap">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectScrbUserMon */
		SELECT DATE_FORMAT(REG_DT, '%d')        regDt
			 , COUNT(1)                         cnt
		FROM T_USER_MNG
		WHERE REG_DT <![CDATA[>=]]> DATE_FORMAT(NOW(), '%Y-01-01 00:00:00')
		  AND DATE_FORMAT(REG_DT, '%m') = #{schEtc00}
		GROUP BY DATE_FORMAT(REG_DT, '%d')
		ORDER BY regDt
	</select>

	<!-- 가입회원 목록 -->
	<select id="selectScrbUserList" parameterType="acsStatVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectScrbUserList */
		SELECT A.USER_ID            userId
			 , A.USER_NM            userNm
			 , B.GRP_AUTH_NM        grpAuthNm
		  FROM T_USER_MNG A
     LEFT JOIN T_GRP_AUTH_MNG B
	        ON A.GRP_AUTH_ID = B.GRP_AUTH_ID AND B.DEL_YN = 'N'
		 WHERE DATE_FORMAT(A.REG_DT, '%Y.%m.%d') = #{schEtc00}
	  ORDER BY A.USER_SERNO DESC
		 LIMIT #{firstRecordIndex} , #{recordCountPerPage}
	</select>

	<!-- 가입회원 건수 -->
	<select id="selectScrbUserCount" parameterType="acsStatVO" resultType="acsStatVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectScrbUserCount */
		SELECT COUNT(1) userCount
		FROM T_USER_MNG
		WHERE DATE_FORMAT(REG_DT, '%Y.%m.%d') = #{schEtc00}
	</select>

	<select id="selectHwpList" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.selectHwpList */
		SELECT A.USER_SERNO		 userSerno
			 , A.USER_ID		 userId
			 , A.USER_NM		 userNm
			 , A.USER_TEL_NO	 userTelNo
			 , A.USER_EMAIL_ADDR userEmailAddr
			 , A.POST_NO		 postNo
			 , A.HOME_ADDR		 homeAddr
			 , A.HOME_ADDR_DTLS	 homeAddrDtls
			 , A.BRK_YN			 brkYn
			 , A.USE_YN			 useYn
			 , A.GRP_AUTH_ID	 grpAuthId
			 , A.AUTH_AREA_CD	 authAreaCd
			 , A.SNS_SE_CD		 snsSeCd
			 , B.GRP_AUTH_NM	 grpAuthNm
			 , CASE WHEN A.PSWD_MSMT_NOCS <![CDATA[ >= ]]> (SELECT LGIN_LMT_CNT FROM T_LGIN_PLCY_MNG) THEN 'Y'
					ELSE 'N'
				END 					lockYn
		  FROM T_USER_MNG A
	 LEFT JOIN T_GRP_AUTH_MNG B
		    ON A.GRP_AUTH_ID  = B.GRP_AUTH_ID
		   AND B.DEL_YN 	  = 'N'
	     <where>
		   <include refid="Where"/>
		   AND A.USER_SERNO IN (<foreach collection="schEtc11" item="item" separator=",">#{item}</foreach>)
		   AND A.AUTH_AREA_CD = #{authAreaCd}
	     </where>
	  ORDER BY USER_SERNO DESC
	</select>

	<!-- 본인글 여부 -->
	<select id="regrCheck" parameterType="userVO" resultType="userVO">
		/* com.opennote.standard.mapper.basic.UserMngMapper.regrCheck */
		SELECT CASE WHEN REGR_SERNO = #{loginSerno} THEN 1 ELSE 0 END isRegrCheck
		  FROM T_USER_MNG
		 WHERE USER_SERNO = #{userSerno}
	</select>

	<!-- 회원가입 약관동의 등록 -->
	<insert id="mergeUserTermsContents" parameterType="kr.or.standard.basic.usersupport.terms.vo.TermsVO$Terms">
		/* com.opennote.standard.mapper.basic.UserMngMapper.mergeUserTermsContents */
		INSERT INTO T_USER_TERMS_MNG (
									   USER_SERNO
									 , TERMS_SERNO
									 , PRD_UNIT_CD
									 , TERMS_AGRE_YN
									 , TERMS_AGRE_YMD
									 , TERMS_EXP_YMD
									 , REGR_SERNO
									 , REG_DT
		) VALUES (
				   #{userSerno}
				 , #{termsSerno}
				 , #{prdUnitCd}
				 , NVL(#{termsAgreeYn}, 'N')
				 , CASE WHEN NVL(#{termsAgreeYn}, 'N') = 'Y'
							THEN DATE_FORMAT(NOW(), '%Y%m%d')
					   END
				 , CASE WHEN NVL(#{termsAgreeYn}, 'N') = 'Y'
							THEN DATE_FORMAT(DATE_ADD(NOW(), INTERVAL (SELECT CD_DTLS_EXPL FROM T_CD_MNG WHERE CD_VAL = #{prdUnitCd} AND USE_YN = 'Y') DAY), '%Y%m%d')
					   END
				 , #{userSerno}
				 , NOW()
				 )
			ON DUPLICATE KEY UPDATE
								 USER_SERNO 		= #{loginSerno}
								 , TERMS_SERNO 		= #{termsSerno}
								 , PRD_UNIT_CD 		= #{prdUnitCd}
								 , TERMS_AGRE_YN 	= NVL(#{termsAgreeYn}, 'N')
								 , TERMS_AGRE_YMD 	= CASE WHEN NVL(#{termsAgreeYn}, 'N') = 'Y'
								 THEN DATE_FORMAT(NOW(), '%Y%m%d')
		END
		, TERMS_EXP_YMD 	= CASE WHEN NVL(#{termsAgreeYn}, 'N') = 'Y'
		THEN DATE_FORMAT(DATE_ADD(NOW(), INTERVAL (SELECT CD_DTLS_EXPL FROM T_CD_MNG WHERE CD_VAL = #{prdUnitCd} AND USE_YN = 'Y') MONTH), '%Y%m%d')
		END
		, UPDR_SERNO 		= #{loginSerno}
		, UPD_DT 			= NOW()
	</insert>
</mapper>